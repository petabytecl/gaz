---
phase: 23-foundation-style-guide
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [STYLE.md]
autonomous: true

must_haves:
  truths:
    - "Contributors can find constructor naming rules in STYLE.md"
    - "Contributors can find error naming conventions in STYLE.md"
    - "Contributors can find module factory pattern in STYLE.md"
    - "Each convention has good/bad examples with rationale"
    - "Exception process exists for deviations"
  artifacts:
    - path: "STYLE.md"
      provides: "API naming conventions and patterns for gaz contributors"
      contains: "MUST"
      min_lines: 150
  key_links:
    - from: "STYLE.md"
      to: "gaz codebase"
      via: "examples extracted from actual code"
      pattern: "Source:.*gaz/"
---

<objective>
Create STYLE.md documenting API naming conventions for gaz contributors.

Purpose: Establish consistent patterns before v3.0 API changes. All subsequent phases reference this guide for constructor naming, error conventions, and module factory patterns.

Output: STYLE.md at repository root with strict MUST language, good/bad examples from actual gaz code, and exception process.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/23-foundation-style-guide/23-CONTEXT.md
@.planning/phases/23-foundation-style-guide/23-RESEARCH.md

# Source files for extracting examples
@gaz/di/errors.go
@gaz/worker/errors.go
@gaz/health/module.go
@gaz/health/manager.go
@gaz/module_builder.go
@gaz/service/builder.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create STYLE.md with naming and constructor conventions</name>
  <files>STYLE.md</files>
  <action>
Create STYLE.md at repository root with:

1. **Document Header**
   - Title: "gaz Style Guide"
   - Scope: API conventions for contributors modifying gaz
   - Note: Uses MUST/SHOULD/MAY per RFC 2119

2. **Naming Conventions Section**
   - Package naming: lowercase, short, no underscores
   - Type naming: PascalCase for exported, camelCase for internal
   - Interface naming: -er suffix when single method, noun when multiple

3. **Constructor Patterns Section**
   Document these patterns with gaz examples:
   - `NewX()` — Returns `*X` when package has multiple types (e.g., `health.NewManager()`)
   - `New()` — Package exports single primary type (e.g., `config.New()`, `service.New()`)
   - `NewXWithY()` — Variant constructor with different setup (e.g., `config.NewWithBackend()`)
   - Builder pattern — For many optional configurations (e.g., `ModuleBuilder`, `service.Builder`)
   
   For each pattern:
   - Rule with MUST language
   - One-liner rationale
   - Good example (from gaz code with source comment)
   - Bad example showing what to avoid

Format per CONTEXT.md:
- Headers only for navigation (no TOC)
- Sequential good/bad examples (not side-by-side)
- Brief rationale after each rule
  </action>
  <verify>
File exists: `ls STYLE.md`
Contains constructor section: `grep -c "Constructor" STYLE.md`
Contains MUST language: `grep -c "MUST" STYLE.md`
  </verify>
  <done>
STYLE.md exists at repository root with naming conventions and all four constructor patterns documented with examples.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add error conventions, module patterns, and exception process</name>
  <files>STYLE.md</files>
  <action>
Extend STYLE.md with:

1. **Error Conventions Section**
   Document these patterns:
   - Sentinel error naming: `ErrXxx` prefix (e.g., `ErrNotFound`, `ErrCycle`)
   - Error message format: `"pkg: description"` lowercase, no punctuation (e.g., `"di: service not found"`)
   - Error wrapping: `fmt.Errorf("context: %w", err)` pattern
   - Error types: `XxxError` suffix (note: not currently used in gaz, document for completeness)

   Include examples from:
   - gaz/di/errors.go (ErrNotFound, ErrCycle, ErrDuplicate)
   - gaz/worker/errors.go (ErrCircuitBreakerTripped)

2. **Module Patterns Section**
   Document:
   - Module factory signature: `func Module(c *gaz.Container) error`
   - ModuleBuilder pattern: `NewModule(name).Provide(...).Build()`
   - Error wrapping in modules: `fmt.Errorf("register X: %w", err)`

   Include examples from:
   - gaz/health/module.go
   - gaz/module_builder.go

3. **Exception Process Section**
   Document process for deviating from conventions:
   1. Document the reason in code comment referencing STYLE.md
   2. Get approval in code review
   3. Justify why the exception is necessary

4. **Automatable Markers**
   Mark conventions that can be enforced with linters:
   - Error variable naming (`Err*`) — [AUTOMATABLE]
   - Package doc exists — [AUTOMATABLE: revive]
   - Doc comment starts with name — [AUTOMATABLE: revive]
  </action>
  <verify>
Error section exists: `grep -c "Error Conventions" STYLE.md`
Module section exists: `grep -c "Module Patterns" STYLE.md`
Exception section exists: `grep -c "Exception" STYLE.md`
Automatable markers: `grep -c "AUTOMATABLE" STYLE.md`
Line count reasonable: `wc -l STYLE.md` (expect 150-300 lines)
  </verify>
  <done>
STYLE.md complete with all four convention categories (naming, constructors, errors, modules), exception process, and automatable markers. Document is self-contained and ready for contributor reference.
  </done>
</task>

</tasks>

<verification>
- [ ] STYLE.md exists at repository root (not in docs/ or .planning/)
- [ ] All four convention categories present (naming, constructors, errors, modules)
- [ ] Each convention uses MUST language
- [ ] Good/bad examples extracted from actual gaz code
- [ ] Exception process documented
- [ ] Automatable rules marked with [AUTOMATABLE]
- [ ] Document length 150-300 lines (focused, not bloated)
</verification>

<success_criteria>
Phase 23 success criteria from roadmap:
1. STYLE.md exists with API naming conventions ✓
2. Constructor patterns documented (New*() vs builders vs fluent) ✓
3. Error naming conventions defined (ErrSubsystemAction format) ✓
4. Module factory function pattern documented ✓
</success_criteria>

<output>
After completion, create `.planning/phases/23-foundation-style-guide/23-01-SUMMARY.md`
</output>
