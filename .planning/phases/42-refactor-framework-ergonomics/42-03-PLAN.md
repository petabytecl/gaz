---
phase: 42
plan: 03
type: execute
wave: 3
depends_on: ["42-02"]
files_modified:
  - examples/grpc-gateway/main.go
autonomous: true
must_haves:
  truths:
    - "Example code is minimal (zero boilerplate)"
    - "Flags work via CLI"
    - "Server shuts down on signal"
  artifacts:
    - path: examples/grpc-gateway/main.go
      provides: "Verified usage example"
  key_links:
    - from: "main.go"
      to: "gaz.WithCobra"
      via: "call"
---

<objective>
Refactor gRPC Gateway example to demonstrate new ergonomics and verify implementation.

Purpose: Prove that the changes in 42-01 and 42-02 actually deliver the expected DX.
Output: Updated main.go matching ux._expected_go pattern.
</objective>

<context>
@examples/grpc-gateway/main.go
@examples/grpc-gateway/ux._expected_go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor main.go to use new patterns</name>
  <files>examples/grpc-gateway/main.go</files>
  <action>
    Refactor `examples/grpc-gateway/main.go` to match the simplicity of `ux._expected_go`:
    1. Remove manual Viper setup and binding.
    2. Remove manual `PersistentPreRunE` logic.
    3. Remove manual `RunE` with signal channel.
    4. Remove manual flag definitions (`serveCmd.Flags().Int...`).
    5. Simplify to:
       - `app := gaz.New()`
       - `app.Use(server.NewModule())`
       - `app.WithCobra(serveCmd)`
       - `rootCmd.Execute()`
    
    Ensure `serveCmd` just has `Use` and `Short` fields.
  </action>
  <verify>
    `go build ./examples/grpc-gateway/...`
  </verify>
  <done>
    Example code is clean and compiles.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Refactored Framework Ergonomics</what-built>
  <how-to-verify>
    1. Run the example:
       `go run examples/grpc-gateway/main.go serve --grpc.port 9999`
    2. Verify it starts on port 9999 (check logs).
    3. Verify it waits (doesn't exit immediately).
    4. Press Ctrl+C and verify graceful shutdown.
  </how-to-verify>
  <resume-signal>Type "approved" if it works as expected</resume-signal>
</task>

</tasks>

<verification>
Manual verification via checkpoint.
</verification>

<output>
After completion, create .planning/phases/42-refactor-framework-ergonomics/42-03-SUMMARY.md
</output>
