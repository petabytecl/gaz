---
phase: 14.2-update-docs
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - docs/configuration.md
  - docs/validation.md
autonomous: true

must_haves:
  truths:
    - "docs/configuration.md shows config package import pattern"
    - "docs/configuration.md shows ConfigProvider pattern for flag-based config"
    - "docs/validation.md uses For[T]() API and config.* imports"
    - "No references to gaz.NewConfigManager, gaz.WithSearchPaths, app.WithConfig"
  artifacts:
    - path: "docs/configuration.md"
      provides: "Configuration documentation with v2.0 patterns"
      contains: "ConfigProvider"
    - path: "docs/validation.md"
      provides: "Validation documentation with v2.0 patterns"
      contains: "gaz.For["
  key_links:
    - from: "docs/configuration.md"
      to: "docs/validation.md"
      via: "Cross-reference to validation"
      pattern: "\\[Validation\\]\\(validation\\.md\\)"
---

<objective>
Rewrite configuration and validation documentation to use the current config package pattern and ConfigProvider pattern.

Purpose: Config APIs changed significantly - gaz.NewConfigManager and app.WithConfig were removed. New pattern uses explicit config package imports and ConfigProvider interface.
Output: Two completely rewritten documentation files demonstrating the correct config patterns.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14.2-update-all-relevant-documentation-and-examples/14.2-CONTEXT.md

Reference for correct v2.0 config patterns:
@doc.go
@config/doc.go
@examples/config-loading/main.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite docs/configuration.md</name>
  <files>docs/configuration.md</files>
  <action>
Completely rewrite docs/configuration.md to use the current configuration patterns.

Current problems:
- Lines 33-42: Uses `gaz.NewConfigManager()` which was removed
- Lines 70-72, 98-100, 145-151: Uses gaz.With* options that were removed
- Lines 183-196, 312-316: Uses `app.WithConfig()` which was removed
- Uses old env var pattern (double underscore `__` separator)

New patterns to document:

1. **Primary pattern: ConfigProvider interface** (from examples/config-loading/main.go)
```go
type ServerConfig struct {
    pv *gaz.ProviderValues
}

func (s *ServerConfig) ConfigNamespace() string { return "server" }
func (s *ServerConfig) ConfigFlags() []gaz.ConfigFlag {
    return []gaz.ConfigFlag{
        {Key: "host", Type: gaz.ConfigFlagTypeString, Default: "localhost", Description: "Server host"},
        {Key: "port", Type: gaz.ConfigFlagTypeInt, Default: 8080, Description: "Server port"},
    }
}

func NewServerConfig(c *gaz.Container) (*ServerConfig, error) {
    pv, err := gaz.Resolve[*gaz.ProviderValues](c)
    if err != nil { return nil, err }
    return &ServerConfig{pv: pv}, nil
}
```

2. **Standalone config package usage** (from config/doc.go)
```go
import "github.com/petabytecl/gaz/config"

mgr := config.New(
    config.WithName("config"),
    config.WithSearchPaths(".", "./config"),
)
if err := mgr.LoadInto(cfg); err != nil {
    log.Fatal(err)
}
```

3. **Environment variable mapping** - single underscore:
   - server.host -> SERVER_HOST
   - server.port -> SERVER_PORT

Structure:
1. ConfigProvider Pattern (primary, most common)
2. Standalone Config Usage (explicit config package import)
3. Environment Variables
4. ConfigFlag Types
5. ProviderValues Access
6. Complete Example

Do NOT document app.WithConfig or gaz.NewConfigManager - these were removed.
  </action>
  <verify>grep -c "gaz.NewConfigManager\|app.WithConfig" docs/configuration.md returns 0; grep -c "ConfigProvider\|ConfigNamespace\|ConfigFlags" docs/configuration.md returns >= 5</verify>
  <done>configuration.md documents ConfigProvider pattern and config package usage with no removed APIs</done>
</task>

<task type="auto">
  <name>Task 2: Update docs/validation.md</name>
  <files>docs/validation.md</files>
  <action>
Update docs/validation.md to use For[T]() API and remove references to app.WithConfig.

Current problems:
- Lines 218-228, 282-293: Uses `app.WithConfig()` which was removed

Changes needed:
1. Replace `app.WithConfig()` with config package pattern or ConfigProvider pattern
2. Update complete example at end of file
3. Keep all validation tag documentation (this is still accurate)
4. Validation still works the same way - just the config loading API changed

The validation tags section (lines 1-216) is correct and should be kept.

Replace the complete example with:
```go
import (
    "github.com/petabytecl/gaz"
    "github.com/petabytecl/gaz/config"
)

// Config struct with validation tags stays the same
type Config struct {
    Server ServerConfig `mapstructure:"server"`
}

// Register config provider
if err := gaz.For[*Config](app.Container()).Provider(func(c *gaz.Container) (*Config, error) {
    cfg := &Config{}
    // Load config
    mgr := config.New(config.WithSearchPaths("."))
    if err := mgr.LoadInto(cfg); err != nil {
        return nil, err
    }
    return cfg, nil
}); err != nil {
    log.Fatal(err)
}
```

Or use the simpler Instance pattern if config is loaded before registration.
  </action>
  <verify>grep -c "app.WithConfig" docs/validation.md returns 0; grep -c "gaz.For\[" docs/validation.md returns >= 1</verify>
  <done>validation.md uses For[T]() or Instance pattern with no references to app.WithConfig</done>
</task>

</tasks>

<verification>
Run after all tasks complete:

```bash
# Verify no old API references
! grep -r "gaz\.NewConfigManager\|app\.WithConfig\|gaz\.WithSearchPaths\|gaz\.WithEnvPrefix" docs/configuration.md docs/validation.md

# Verify ConfigProvider pattern documented
grep -c "ConfigProvider\|ConfigNamespace" docs/configuration.md  # Should be >= 3

# Verify For[T]() or config.* imports used
grep -c "gaz\.For\[" docs/validation.md  # Should be >= 1
```
</verification>

<success_criteria>
- docs/configuration.md documents ConfigProvider pattern as primary approach
- docs/configuration.md shows explicit config package imports
- docs/validation.md updated to use For[T]() API
- No references to removed APIs (gaz.NewConfigManager, app.WithConfig, gaz.WithSearchPaths, etc.)
- Environment variable mapping updated to single underscore pattern
- Cross-references preserved
</success_criteria>

<output>
After completion, create `.planning/phases/14.2-update-all-relevant-documentation-and-examples/14.2-02-SUMMARY.md`
</output>
