---
phase: 22-test-coverage-improvement
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - config/validation_test.go
  - config/accessor_test.go
  - config/manager_test.go
autonomous: true

must_haves:
  truths:
    - "humanizeTag is tested for all validation tag types"
    - "typeNameOf covers all type switch cases"
    - "BindFlags is tested with cobra command"
    - "WithConfigFile option is tested"
  artifacts:
    - path: "config/validation_test.go"
      provides: "Extended tests for humanizeTag"
    - path: "config/accessor_test.go"
      provides: "Tests for typeNameOf edge cases"
    - path: "config/manager_test.go"
      provides: "Tests for BindFlags"
  key_links:
    - from: "config/validation_test.go"
      to: "config/validation.go"
      via: "humanizeTag coverage"
---

<objective>
Improve config package test coverage from 77.1% to 90%+

Purpose: Cover low-coverage functions humanizeTag (26.3%), typeNameOf (28.6%), BindFlags (0%)
Output: Comprehensive tests for validation and accessor edge cases
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@config/validation.go
@config/accessor.go
@config/manager.go
@config/validation_test.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add humanizeTag comprehensive tests</name>
  <files>config/validation_test.go</files>
  <action>
Add TestHumanizeTag to config/validation_test.go:

Table-driven test covering ALL switch cases in humanizeTag:
- "required" → "required field cannot be empty"
- "min" with param "5" → "must be at least 5"
- "max" with param "100" → "must be at most 100"
- "oneof" with param "a b c" → "must be one of: a b c"
- "required_if" with param "Field value"
- "required_unless" with param "Field value"
- "required_with" with param "OtherField"
- "required_without" with param "OtherField"
- "gte" with param "10"
- "lte" with param "50"
- "gt" with param "0"
- "lt" with param "100"
- "email" → "must be a valid email address"
- "url" → "must be a valid URL"
- "ip" → "must be a valid IP address"
- "ipv4" → "must be a valid IPv4 address"
- "ipv6" → "must be a valid IPv6 address"
- "unknown_tag" → "failed unknown_tag validation" (default case)

Since humanizeTag is unexported, test it indirectly via ValidateStruct with structs that trigger each validation tag.
  </action>
  <verify>go test -v -run "TestHumanizeTag|TestValidate" ./config/...</verify>
  <done>humanizeTag indirectly tested via ValidateStruct for all 17 switch cases plus default</done>
</task>

<task type="auto">
  <name>Task 2: Add typeNameOf and accessor edge case tests</name>
  <files>config/accessor_test.go</files>
  <action>
Extend config/accessor_test.go with:

1. TestTypeNameOf - cover all type switch cases:
   - string → "string"
   - int → "int"
   - int64 → "int64"
   - float64 → "float64"
   - bool → "bool"
   - struct{} → "unknown" (default case)
   - Custom type → "unknown"

Note: typeNameOf is unexported, so test via MustGet which calls it in panic message.
Create test that calls MustGet with wrong type to trigger type assertion panic.

2. TestMustGet_TypeMismatch:
   - Set up manager with string value
   - Call MustGet[int] to trigger type mismatch panic
   - Verify panic message contains expected type name
  </action>
  <verify>go test -v -run "TestMustGet|TestTypeNameOf" ./config/...</verify>
  <done>typeNameOf tested for string, int, int64, float64, bool, and unknown types via MustGet panics</done>
</task>

<task type="auto">
  <name>Task 3: Add BindFlags and WithConfigFile tests</name>
  <files>config/manager_test.go</files>
  <action>
Extend config/manager_test.go with:

1. TestBindFlags:
   - Create cobra.Command with pflags
   - Create config manager
   - Call BindFlags with command.Flags()
   - Verify config values reflect flag values
   
2. TestWithConfigFile:
   - Create temp config file
   - Use WithConfigFile option pointing to it
   - Verify config loaded from explicit file path

Note: BindFlags delegates to backend.BindPFlags - test integration not just method call.
  </action>
  <verify>go test -v -run "TestBindFlags|TestWithConfigFile" ./config/...</verify>
  <done>BindFlags tested with cobra flags, WithConfigFile option tested with temp file</done>
</task>

</tasks>

<verification>
```bash
go test -cover ./config/... 2>&1 | grep "coverage:"
# Expected: coverage should be 90%+ (up from 77.1%)
```
</verification>

<success_criteria>
- config package coverage reaches 90%+
- humanizeTag coverage: 90%+ (was 26.3%)
- typeNameOf coverage: 90%+ (was 28.6%)
- BindFlags coverage: 80%+ (was 0%)
</success_criteria>

<output>
After completion, create `.planning/phases/22-test-coverage-improvement/22-02-SUMMARY.md`
</output>
