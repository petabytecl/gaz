---
phase: 27-error-standardization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gaz/errors.go
autonomous: true

must_haves:
  truths:
    - "All sentinel errors defined in single gaz/errors.go file"
    - "Error names use ErrSubsystemAction format"
    - "Typed errors implement Unwrap for errors.Is/As"
  artifacts:
    - path: "gaz/errors.go"
      provides: "All sentinel errors and typed errors"
      contains: "ErrDINotFound"
      exports: ["ErrDINotFound", "ErrDICycle", "ErrConfigValidation", "ErrWorkerStopped", "ResolutionError", "LifecycleError"]
  key_links:
    - from: "gaz/errors.go"
      to: "errors package"
      via: "errors.New for sentinels"
      pattern: "errors\\.New"
---

<objective>
Create the consolidated gaz/errors.go with all sentinel errors using namespaced naming, plus typed errors for recovery scenarios.

Purpose: Establish single source of truth for all gaz framework errors before updating package references
Output: Complete gaz/errors.go with all sentinels and typed errors ready for use
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/27-error-standardization/27-CONTEXT.md
@.planning/phases/27-error-standardization/27-RESEARCH.md
@gaz/errors.go
@di/errors.go
@config/errors.go
@worker/errors.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create consolidated sentinel errors</name>
  <files>gaz/errors.go</files>
  <action>
Replace the current gaz/errors.go (which re-exports from di) with a new file containing ALL sentinel errors. Use the naming convention from CONTEXT.md:

**DI subsystem errors:**
- `ErrDINotFound = errors.New("di: not found")`
- `ErrDICycle = errors.New("di: circular dependency")`
- `ErrDIDuplicate = errors.New("di: duplicate registration")`
- `ErrDINotSettable = errors.New("di: field not settable")`
- `ErrDITypeMismatch = errors.New("di: type mismatch")`
- `ErrDIAlreadyBuilt = errors.New("di: already built")`
- `ErrDIInvalidProvider = errors.New("di: invalid provider")`

**Config subsystem errors:**
- `ErrConfigValidation = errors.New("config: validation failed")`
- `ErrConfigNotFound = errors.New("config: key not found")`

**Worker subsystem errors:**
- `ErrWorkerCircuitTripped = errors.New("worker: circuit breaker tripped")`
- `ErrWorkerStopped = errors.New("worker: stopped normally")`
- `ErrWorkerCriticalFailed = errors.New("worker: critical worker failed")`
- `ErrWorkerManagerRunning = errors.New("worker: manager already running")`

**Cron subsystem errors:**
- `ErrCronNotRunning = errors.New("cron: scheduler not running")`

**Module errors (gaz-specific):**
- `ErrModuleDuplicate = errors.New("gaz: duplicate module")`
- `ErrConfigKeyCollision = errors.New("gaz: config key collision")`

Group by subsystem with comment headers. Only import "errors" package (remove di import).
  </action>
  <verify>
Run `go build ./...` - should succeed (existing code still imports from di/config/worker)
  </verify>
  <done>
gaz/errors.go contains all 16 sentinel errors with subsystem prefixes, no imports from subsystem packages
  </done>
</task>

<task type="auto">
  <name>Task 2: Add typed errors for recovery scenarios</name>
  <files>gaz/errors.go</files>
  <action>
Add typed errors below the sentinel errors section. Each typed error must implement Error(), Unwrap(), and proper formatting:

**ResolutionError** - for DI resolution failures:
```go
type ResolutionError struct {
    ServiceName string   // The service that failed to resolve
    Chain       []string // Resolution chain leading to failure  
    Cause       error    // Underlying error
}

func (e *ResolutionError) Error() string { ... }
func (e *ResolutionError) Unwrap() error { return e.Cause }
```

**LifecycleError** - for start/stop failures:
```go
type LifecycleError struct {
    ServiceName string // Service that failed
    Phase       string // "start" or "stop"
    Cause       error  // Underlying error
}

func (e *LifecycleError) Error() string { ... }
func (e *LifecycleError) Unwrap() error { return e.Cause }
```

**ValidationError** - move from config/errors.go (DO NOT delete original yet):
- Copy ValidationError struct with Errors []FieldError
- Copy FieldError struct
- Copy NewFieldError and NewValidationError constructors
- ValidationError.Unwrap() should return ErrConfigValidation

Keep fmt import for error formatting. Add strings import for Join.
  </action>
  <verify>
Run `go build ./...` and `go test ./...` - all should pass
  </verify>
  <done>
gaz/errors.go contains ResolutionError, LifecycleError, ValidationError, FieldError types with proper Unwrap implementations
  </done>
</task>

</tasks>

<verification>
1. `go build ./...` passes (no compile errors)
2. `go test ./...` passes (existing tests still work)
3. gaz/errors.go contains all 16 sentinel errors with correct naming
4. gaz/errors.go contains typed errors with Unwrap methods
5. `grep -c "Err.*=" gaz/errors.go` shows ~16-17 sentinel definitions
</verification>

<success_criteria>
- All sentinel errors consolidated in gaz/errors.go with ErrSubsystemAction naming
- Typed errors (ResolutionError, LifecycleError, ValidationError) defined with Unwrap
- No import from subsystem packages (errors are now source of truth)
- Existing code still compiles (old locations not deleted yet)
</success_criteria>

<output>
After completion, create `.planning/phases/27-error-standardization/27-01-SUMMARY.md`
</output>
