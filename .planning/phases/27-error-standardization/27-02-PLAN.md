---
phase: 27-error-standardization
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - di/errors.go
  - di/container.go
  - di/inject.go
  - di/resolution.go
  - di/service.go
  - di/doc.go
autonomous: true

must_haves:
  truths:
    - "di package no longer defines its own sentinel errors"
    - "All di package code imports gaz and uses gaz.ErrDI* errors"
    - "Error wrapping uses 'di: context: %w' format"
  artifacts:
    - path: "di/container.go"
      provides: "DI container using gaz errors"
      contains: "gaz.ErrDI"
  key_links:
    - from: "di/*.go"
      to: "gaz/errors.go"
      via: "import and error references"
      pattern: "gaz\\.ErrDI"
---

<objective>
Migrate the di package to use consolidated gaz errors.

Purpose: Remove di/errors.go as error source, all DI errors now come from gaz/errors.go
Output: di package using gaz.ErrDI* errors with consistent wrapping format
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/27-error-standardization/27-CONTEXT.md
@.planning/phases/27-error-standardization/27-01-SUMMARY.md
@gaz/errors.go
@di/errors.go
@di/container.go
@di/inject.go
@di/resolution.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update di package to use gaz errors</name>
  <files>di/container.go, di/inject.go, di/resolution.go, di/service.go, di/lifecycle_engine.go</files>
  <action>
Update all di package files to import gaz and use new error names. For each file:

1. Add import: `"github.com/petabytecl/gaz"` 
2. Replace error references:
   - `ErrNotFound` → `gaz.ErrDINotFound`
   - `ErrCycle` → `gaz.ErrDICycle`
   - `ErrDuplicate` → `gaz.ErrDIDuplicate`
   - `ErrNotSettable` → `gaz.ErrDINotSettable`
   - `ErrTypeMismatch` → `gaz.ErrDITypeMismatch`
   - `ErrAlreadyBuilt` → `gaz.ErrDIAlreadyBuilt`
   - `ErrInvalidProvider` → `gaz.ErrDIInvalidProvider`

3. Update error wrapping to use "di: context: %w" format consistently.

Note: di package imports gaz - this is the correct dependency direction (subsystem imports core).

For doc.go, update any documentation examples that reference di.ErrNotFound to show errors.Is with the wrapped error pattern.
  </action>
  <verify>
Run `go build ./di/...` - should compile successfully
  </verify>
  <done>
All di/*.go files import gaz and use gaz.ErrDI* errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete di/errors.go and update tests</name>
  <files>di/errors.go, di/*_test.go</files>
  <action>
1. Delete `di/errors.go` completely (all sentinels now in gaz/errors.go)

2. Update di test files:
   - Add `"github.com/petabytecl/gaz"` import where needed
   - Replace `ErrNotFound` → `gaz.ErrDINotFound` in test assertions
   - Replace other error references similarly
   - Update any `errors.Is(err, ErrNotFound)` to `errors.Is(err, gaz.ErrDINotFound)`

Files to check: di/container_test.go, di/inject_test.go, di/resolution_test.go, di/service_test.go
  </action>
  <verify>
Run `go test ./di/...` - all tests should pass
  </verify>
  <done>
di/errors.go deleted, all di tests pass using gaz.ErrDI* errors
  </done>
</task>

</tasks>

<verification>
1. `ls di/errors.go` returns "No such file" (deleted)
2. `go build ./di/...` passes
3. `go test ./di/...` passes
4. `grep -r "ErrNotFound" di/*.go` shows only gaz.ErrDINotFound references (no bare ErrNotFound)
</verification>

<success_criteria>
- di/errors.go is deleted
- All di package code uses gaz.ErrDI* errors
- All di tests pass
- No bare error references (ErrNotFound without gaz. prefix)
</success_criteria>

<output>
After completion, create `.planning/phases/27-error-standardization/27-02-SUMMARY.md`
</output>
