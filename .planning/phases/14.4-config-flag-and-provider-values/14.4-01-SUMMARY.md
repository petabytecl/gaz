---
phase: 14.4-config-flag-and-provider-values
plan: 01
subsystem: config
tags: [config, viper, di, provider-values]

# Dependency graph
requires:
  - phase: 14.3
    provides: ConfigProvider pattern with ProviderValues resolved in main()
provides:
  - WithConfigFile option for explicit config file paths
  - SetConfigFile method on ViperBackend
  - Early ProviderValues registration in Build()
  - ProviderValues injection in provider functions
affects: [15-cron, 16-event-bus]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "Early service registration pattern for cross-cutting concerns"
    - "ProviderValues injection in provider constructors"

key-files:
  created: []
  modified:
    - config/manager.go
    - config/options.go
    - config/viper/backend.go
    - app.go
    - examples/config-loading/main.go

key-decisions:
  - "ProviderValues registered BEFORE collectProviderConfigs in Build()"
  - "WithConfigFile bypasses search paths when set"
  - "configFileSetter interface for backend abstraction"

patterns-established:
  - "Early registration: Register cross-cutting dependencies before provider instantiation"
  - "Accessor methods: Config providers expose typed getters using injected ProviderValues"

# Metrics
duration: 3min
completed: 2026-01-28
---

# Phase 14.4 Plan 01: Config Flag and ProviderValues Summary

**WithConfigFile option for explicit config paths and early ProviderValues registration enabling injection in provider constructors**

## Performance

- **Duration:** 3 min
- **Started:** 2026-01-28T23:45:17Z
- **Completed:** 2026-01-28T23:48:36Z
- **Tasks:** 2
- **Files modified:** 5

## Accomplishments

- Added `WithConfigFile(path)` option for explicit config file paths
- Added `SetConfigFile()` method to ViperBackend
- Moved ProviderValues registration to occur BEFORE provider instantiation
- Updated example to demonstrate ProviderValues injection in provider constructor
- Added accessor methods (Host, Port, Debug) to ServerConfig in example

## Task Commits

Each task was committed atomically:

1. **Task 1: Add config file path support** - `fa148dc` (feat)
2. **Task 2: Move ProviderValues early and update example** - `5424458` (feat)

## Files Created/Modified

- `config/manager.go` - Added configFile field, configFileSetter interface, Load() updates
- `config/options.go` - Added WithConfigFile option
- `config/viper/backend.go` - Added SetConfigFile method
- `app.go` - Added registerProviderValuesEarly(), updated Build() order
- `examples/config-loading/main.go` - ProviderValues injection in provider pattern

## Decisions Made

1. **ProviderValues registered BEFORE collectProviderConfigs** - This enables providers to inject ProviderValues as a dependency during construction, enabling the standard DI pattern
2. **WithConfigFile bypasses search paths** - When explicit path is set, SetConfigFile is used instead of SetConfigName + AddConfigPath
3. **configFileSetter interface** - Keeps backend abstraction clean for explicit config file support

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered

None

## Next Phase Readiness

- Config package now supports explicit config file paths
- ProviderValues can be injected in any provider function
- Ready for CLI integration with --config flag
- Phase 14.4 complete

---
*Phase: 14.4-config-flag-and-provider-values*
*Completed: 2026-01-28*
