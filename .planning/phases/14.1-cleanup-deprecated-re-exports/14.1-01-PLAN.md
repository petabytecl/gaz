---
phase: 14.1-cleanup-deprecated-re-exports
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - options.go
  - config.go
  - errors.go
  - compat.go
  - config_manager.go
autonomous: true

must_haves:
  truths:
    - "options.go file does not exist in root package"
    - "config.go file does not exist in root package"
    - "gaz.ErrConfigValidation is not exported"
    - "DI APIs in compat.go have no deprecation markers"
    - "config_manager.go compiles with config.Option"
  artifacts:
    - path: "errors.go"
      provides: "gaz-native errors only"
      contains: "ErrDuplicateModule"
      not_contains: "ErrConfigValidation"
    - path: "compat.go"
      provides: "DI and Worker type aliases without deprecation"
      contains: "type Container = di.Container"
    - path: "config_manager.go"
      provides: "ConfigManager using config.Option"
      contains: "config.Option"
  key_links:
    - from: "config_manager.go"
      to: "config.Option"
      via: "direct import"
      pattern: "opts \\.\\.\\.config\\.Option"
---

<objective>
Remove deprecated config re-exports from root gaz package and finalize the kept API surface.

Purpose: Clean up backward compatibility layer - users importing deprecated gaz.With* options must now import gaz/config directly. DI/Worker aliases remain as permanent convenience exports.

Output: 
- Deleted: options.go, config.go
- Updated: errors.go (no ErrConfigValidation), compat.go (no deprecation markers), config_manager.go (uses config.Option)
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/14.1-cleanup-deprecated-re-exports/14.1-CONTEXT.md

# Source files being modified
@options.go
@config.go
@errors.go
@compat.go
@config_manager.go
</context>

<tasks>

**ATOMICITY NOTE:** Tasks 1-3 must be executed together before any intermediate compilation check. Task 1 deletes ConfigOption alias, Task 3 updates config_manager.go to use config.Option. The package won't compile between Task 1 and Task 3 completion.

<task type="auto">
  <name>Task 1: Delete deprecated config re-export files</name>
  <files>options.go, config.go</files>
  <action>
Delete both files entirely:

1. Delete `options.go` - contains deprecated ConfigOption type alias and With* function re-exports
2. Delete `config.go` - contains deprecated Defaulter and Validator type aliases

Use `rm` or the equivalent to remove these files from the root package.
  </action>
  <verify>
```bash
# Files should not exist
test ! -f options.go && test ! -f config.go && echo "Files deleted"
```
  </verify>
  <done>options.go and config.go no longer exist in root package</done>
</task>

<task type="auto">
  <name>Task 2: Update errors.go and compat.go</name>
  <files>errors.go, compat.go</files>
  <action>
**errors.go changes:**
Remove the ErrConfigValidation alias. The file should keep:
- DI error aliases (ErrNotFound, ErrCycle, ErrDuplicate, ErrNotSettable, ErrTypeMismatch, ErrAlreadyBuilt, ErrInvalidProvider) - these are ergonomic conveniences
- gaz-native errors (ErrDuplicateModule, ErrConfigKeyCollision)
- Remove the import of "github.com/petabytecl/gaz/config" since it's only used for ErrConfigValidation

**compat.go changes:**
Remove "Deprecated" comments from the APIs we're keeping. According to CONTEXT.md decisions:
- Keep all DI APIs (For, Resolve, MustResolve, Has, Named, TypeName, typeName, NewContainer, Container type alias)
- Keep type aliases (ResolveOption, RegistrationBuilder, ServiceWrapper, serviceWrapper)
- Keep Worker interface alias

Remove the `// Deprecated:` comments from NewContainer since we're keeping it as a permanent API (it just delegates to di.New()).

Keep all documentation comments, just remove the deprecation notices.
  </action>
  <verify>
```bash
# Check errors.go doesn't have ErrConfigValidation
! grep -q "ErrConfigValidation" errors.go && echo "ErrConfigValidation removed"
# Check config import is removed from errors.go
! grep -q 'gaz/config' errors.go && echo "config import removed from errors.go"
# Check compat.go doesn't have Deprecated comments
! grep -q "Deprecated:" compat.go && echo "Deprecation markers removed"
```
  </verify>
  <done>errors.go exports only DI error aliases and gaz-native errors; compat.go has no deprecation markers</done>
</task>

<task type="auto">
  <name>Task 3: Update config_manager.go signature</name>
  <files>config_manager.go</files>
  <action>
Update NewConfigManager to use config.Option directly instead of ConfigOption:

Change:
```go
func NewConfigManager(target any, opts ...ConfigOption) *ConfigManager {
```

To:
```go
func NewConfigManager(target any, opts ...config.Option) *ConfigManager {
```

The function is deprecated (users should use config.New directly), but it must still compile. The signature change is required because ConfigOption (the alias) no longer exists.

Keep the `// Deprecated:` comment on NewConfigManager and ConfigManager type - these ARE deprecated, users should use config.Manager.
  </action>
  <verify>
```bash
# Check the signature uses config.Option
grep -q "opts ...config.Option" config_manager.go && echo "Signature updated"
# Compile check
go build ./... 2>&1 | head -20
```
  </verify>
  <done>NewConfigManager accepts config.Option variadic parameter</done>
</task>

</tasks>

<verification>
```bash
# All deprecated files deleted
test ! -f options.go && test ! -f config.go

# Root package compiles
go build .

# No deprecated config re-exports (ConfigOption, With*, Defaulter, Validator)
! grep -rn "type ConfigOption" *.go
! grep -rn "var WithName" *.go
! grep -rn "type Defaulter" *.go

# DI APIs still exported
grep -q "func For\[T any\]" compat.go
grep -q "func Resolve\[T any\]" compat.go
grep -q "type Container = di.Container" compat.go
```
</verification>

<success_criteria>
1. options.go and config.go files deleted
2. errors.go no longer exports ErrConfigValidation
3. compat.go exports DI/Worker APIs without deprecation markers
4. config_manager.go compiles with config.Option parameter
5. `go build .` succeeds for root package
</success_criteria>

<output>
After completion, create `.planning/phases/14.1-cleanup-deprecated-re-exports/14.1-01-SUMMARY.md`
</output>
