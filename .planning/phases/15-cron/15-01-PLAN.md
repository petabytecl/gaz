---
phase: 15-cron
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - cron/doc.go
  - cron/job.go
  - cron/logger.go
  - go.mod
  - go.sum
autonomous: true

must_haves:
  truths:
    - "CronJob interface defined with Name(), Schedule(), Timeout(), Run(ctx) methods"
    - "robfig/cron v3 dependency available in go.mod"
    - "slog adapter implements cron.Logger interface"
  artifacts:
    - path: "cron/job.go"
      provides: "CronJob interface definition"
      exports: ["CronJob"]
    - path: "cron/doc.go"
      provides: "Package documentation with usage example"
      min_lines: 30
    - path: "cron/logger.go"
      provides: "slog adapter for cron.Logger interface"
      exports: ["NewSlogAdapter"]
  key_links:
    - from: "cron/logger.go"
      to: "robfig/cron.Logger"
      via: "implements interface"
      pattern: "Info.*Error.*interface"
---

<objective>
Create the cron package foundation with CronJob interface definition, package documentation, and slog adapter for robfig/cron's Logger interface.

Purpose: Establish the core types and dependencies needed for scheduled task support before implementing Scheduler.
Output: cron package with CronJob interface, slog adapter, and robfig/cron v3 dependency.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-cron/15-CONTEXT.md
@.planning/phases/15-cron/15-RESEARCH.md
@worker/doc.go
@worker/worker.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cron package with CronJob interface and documentation</name>
  <files>cron/doc.go, cron/job.go, go.mod, go.sum</files>
  <action>
1. Add robfig/cron v3 dependency:
   ```bash
   go get github.com/robfig/cron/v3@v3.0.1
   ```

2. Create `cron/doc.go` with package documentation following worker/doc.go pattern:
   - Package overview explaining scheduled task support
   - Usage example showing CronJob implementation and registration
   - Reference predefined schedules (@hourly, @daily, etc.)

3. Create `cron/job.go` with CronJob interface per CONTEXT.md locked decision:
   ```go
   type CronJob interface {
       // Name returns a human-readable identifier for logging
       Name() string

       // Schedule returns the cron expression or predefined schedule
       // Examples: "*/5 * * * *", "@hourly", "@daily"
       // Return empty string to disable this job
       Schedule() string

       // Timeout returns the execution timeout (0 for none)
       Timeout() time.Duration

       // Run executes the job with the given context
       // Context is cancelled on app shutdown or timeout
       Run(ctx context.Context) error
   }
   ```

4. Add godoc comments explaining each method and their contract.
  </action>
  <verify>`go build ./cron/...` compiles successfully</verify>
  <done>CronJob interface exported from cron package, robfig/cron v3 in go.mod</done>
</task>

<task type="auto">
  <name>Task 2: Create slog adapter for cron.Logger interface</name>
  <files>cron/logger.go</files>
  <action>
1. Create `cron/logger.go` with slog adapter implementing robfig/cron.Logger interface:

2. The adapter must implement these methods from cron.Logger:
   - `Info(msg string, keysAndValues ...interface{})`
   - `Error(err error, msg string, keysAndValues ...interface{})`

3. Create `NewSlogAdapter(logger *slog.Logger) cron.Logger` constructor.

4. Implement helper `keysAndValuesToSlog(kvs []interface{}) []any` to convert key-value pairs to slog attributes.

5. The adapter should add "component" attribute with value "cron" for log correlation.

Pattern from RESEARCH.md:
```go
type slogAdapter struct {
    logger *slog.Logger
}

func NewSlogAdapter(logger *slog.Logger) cron.Logger {
    return &slogAdapter{logger: logger.With("component", "cron")}
}

func (a *slogAdapter) Info(msg string, keysAndValues ...interface{}) {
    a.logger.Info(msg, keysAndValuesToSlog(keysAndValues)...)
}

func (a *slogAdapter) Error(err error, msg string, keysAndValues ...interface{}) {
    attrs := keysAndValuesToSlog(keysAndValues)
    attrs = append(attrs, slog.Any("error", err))
    a.logger.Error(msg, attrs...)
}
```
  </action>
  <verify>`go build ./cron/...` compiles, `go vet ./cron/...` passes</verify>
  <done>slog adapter implements cron.Logger interface, can be used with robfig/cron</done>
</task>

</tasks>

<verification>
1. `go build ./cron/...` - Package compiles
2. `go vet ./cron/...` - No vet errors
3. `grep -q "robfig/cron/v3" go.mod` - Dependency added
4. `grep -q "CronJob interface" cron/job.go` - Interface defined
5. `grep -q "cron.Logger" cron/logger.go` - Logger adapter exists
</verification>

<success_criteria>
- CronJob interface matches CONTEXT.md specification exactly (Name, Schedule, Timeout, Run)
- robfig/cron v3.0.1 in go.mod
- slog adapter implements cron.Logger interface
- Package compiles and passes vet
</success_criteria>

<output>
After completion, create `.planning/phases/15-cron/15-01-SUMMARY.md`
</output>
