---
phase: 02.1-improve-code-quality
plan: 03
type: execute
wave: 2
depends_on: ["02.1-01"]
files_modified:
  - service.go
  - types.go
  - lifecycle_engine.go
autonomous: true

must_haves:
  truths:
    - "No wrapcheck issues in service.go"
    - "No shadow issues in service.go"
    - "No exhaustive issues in types.go"
    - "No perfsprint issues in lifecycle_engine.go"
  artifacts:
    - path: "service.go"
      provides: "Fixed error wrapping and shadowing"
    - path: "types.go"
      provides: "Exhaustive switch with default"
    - path: "lifecycle_engine.go"
      provides: "Fixed perfsprint issue"
  key_links:
    - from: "service.go"
      to: "Starter/Stopper interfaces"
      via: "wrapped error returns"
      pattern: "fmt\\.Errorf.*%w"
---

<objective>
Fix production code lint issues in service.go, types.go, lifecycle_engine.go

Purpose: Resolve wrapcheck, shadow, exhaustive, unused-parameter, perfsprint issues
Output: Clean production code in remaining core files
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@service.go
@types.go
@lifecycle_engine.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix service.go lint issues</name>
  <files>service.go</files>
  <action>
Fix the following issues in service.go:

1. **wrapcheck** (lines 248, 265, 328, 338): Wrap errors from interface methods
   - Change `return err` to `return fmt.Errorf("service %s: %w", name, err)`
   - The errors from Starter.OnStart() and Stopper.OnStop() should be wrapped
   - Include service name in error message for debugging

2. **shadow** (lines 86, 160, 222): Fix variable shadowing of `err`
   - Use `=` instead of `:=` when `err` is already declared in outer scope
   - Or use a different variable name like `innerErr`

3. **unused-parameter** (line 315): Rename unused `c` parameter to `_`
   - Change `func (s *instanceService[T]) getInstance(c *Container, ...)` 
   - To `func (s *instanceService[T]) getInstance(_ *Container, ...)`
  </action>
  <verify>Run `make lint 2>&1 | grep "service\.go" | grep -v "_test" | wc -l` returns 0</verify>
  <done>service.go has zero production lint issues</done>
</task>

<task type="auto">
  <name>Task 2: Fix types.go and lifecycle_engine.go lint issues</name>
  <files>types.go, lifecycle_engine.go</files>
  <action>
**types.go fixes:**

1. **exhaustive** (line 32): Add default case to reflect.Kind switch
   - The switch on `t.Kind()` only handles Pointer case
   - Add a default case that returns the type name as-is:
     ```go
     switch t.Kind() {
     case reflect.Pointer:
         // existing logic
     default:
         return t.String()
     }
     ```

**lifecycle_engine.go fixes:**

1. **perfsprint** (line 76): Use errors.New instead of fmt.Errorf
   - Change `fmt.Errorf("cycle detected in dependency graph")` 
   - To `errors.New("cycle detected in dependency graph")`
   - Import "errors" package if not already imported
  </action>
  <verify>Run `make lint 2>&1 | grep -E "(types\.go|lifecycle_engine\.go)" | grep -v "_test" | wc -l` returns 0</verify>
  <done>types.go and lifecycle_engine.go have zero production lint issues</done>
</task>

</tasks>

<verification>
```bash
# Verify no production issues in these files
make lint 2>&1 | grep -E "(service\.go|types\.go|lifecycle_engine\.go)" | grep -v "_test"

# Should show nothing
```
</verification>

<success_criteria>
- [ ] wrapcheck issues fixed in service.go (4 issues)
- [ ] shadow issues fixed in service.go (3 issues)
- [ ] unused-parameter issue fixed in service.go (1 issue)
- [ ] exhaustive issue fixed in types.go (1 issue)
- [ ] perfsprint issue fixed in lifecycle_engine.go (1 issue)
- [ ] Total: ~10 issues resolved
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-improve-code-quality-validating-linter-config/02.1-03-SUMMARY.md`
</output>
