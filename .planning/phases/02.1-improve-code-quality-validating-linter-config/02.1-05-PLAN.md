---
phase: 02.1-improve-code-quality
plan: 05
type: execute
wave: 3
depends_on: ["02.1-04"]
files_modified:
  - app_test.go
  - container_test.go
  - container_graph_test.go
  - inject_test.go
  - resolution_test.go
  - service_test.go
autonomous: true

must_haves:
  truths:
    - "No errcheck issues in test files"
    - "No gosec G104 issues in test files"
    - "No govet shadow issues in test files"
    - "No unused type/field issues"
    - "No intrange issues"
    - "make lint passes cleanly"
  artifacts:
    - path: "*_test.go"
      provides: "Fully lint-compliant test files"
  key_links:
    - from: "test registrations"
      to: "error handling"
      via: "explicit error check or assignment"
      pattern: "err.*:=.*Provider|err.*:=.*Instance"
---

<objective>
Fix remaining test code lint issues: errcheck, shadow, unused, intrange

Purpose: Eliminate all remaining lint errors to achieve clean `make lint`
Output: All tests pass lint checks, `make lint` exits with 0
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/02.1-improve-code-quality-validating-linter-config/02.1-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix errcheck and gosec issues in test files</name>
  <files>app_test.go, container_test.go, container_graph_test.go, service_test.go</files>
  <action>
Fix unchecked error returns in test files (~41 errcheck + 4 gosec issues):

**Pattern 1: Registration builder chains**
The most common issue is unchecked `.Provider()` or `.Instance()` returns:

```go
// Before (bad):
For[*Service](c).Provider(func(_ *Container) (*Service, error) { ... })

// After (good) - capture and check error:
err := For[*Service](c).Provider(func(_ *Container) (*Service, error) { ... })
s.Require().NoError(err)
```

**Pattern 2: Type assertions**
```go
// Before (bad):
ts := instance.(*testService)

// After (good):
ts, ok := instance.(*testService)
s.Require().True(ok)
```

**Pattern 3: syscall.Kill (app_test.go line 124)**
```go
// Before (bad):
syscall.Kill(syscall.Getpid(), syscall.SIGTERM)

// After (good):
err := syscall.Kill(syscall.Getpid(), syscall.SIGTERM)
s.Require().NoError(err)
```

**Files with most issues:**
- container_test.go: ~20 Provider/Instance calls
- app_test.go: 5 issues including syscall.Kill
- container_graph_test.go: 2 Provider calls
- service_test.go: 4 type assertions

Go through each file and add proper error handling.
  </action>
  <verify>Run `make lint 2>&1 | grep -E "(errcheck|gosec)" | wc -l` returns 0</verify>
  <done>All errcheck and gosec issues in test files resolved (~45 issues)</done>
</task>

<task type="auto">
  <name>Task 2: Fix shadow, unused, and intrange issues</name>
  <files>app_test.go, resolution_test.go, inject_test.go, service_test.go</files>
  <action>
**govet shadow issues (~5 remaining in test files):**
- app_test.go lines 98, 165: `err` shadows outer declaration
  - Use `=` instead of `:=` or rename variable
- resolution_test.go lines 128, 183, 193: `err` shadows outer declaration
  - Same fix: use `=` or rename

**unused issues (3):**
- inject_test.go line 125: field `db` is unused
  - Remove the field or use it in a test
- resolution_test.go line 19: field `value` is unused  
  - Remove the field or use it
- resolution_test.go line 22: type `testServiceC` is unused
  - Remove the type definition

**intrange issues (2):**
- service_test.go line 69: Use integer range loop
  - Change `for i := 0; i < len(slice); i++` to `for i := range slice`
  - Or `for i := range len(slice)` if only index needed

Apply fixes and verify all tests still pass.
  </action>
  <verify>Run `make lint 2>&1 | grep -E "(shadow|unused|intrange)" | wc -l` returns 0</verify>
  <done>All shadow, unused, and intrange issues resolved (~10 issues)</done>
</task>

</tasks>

<verification>
```bash
# Final verification - lint should pass completely
make lint

# If any issues remain, check count
make lint 2>&1 | tail -10

# Run full test suite
make test

# Run coverage to ensure nothing broke
make coverage
```
</verification>

<success_criteria>
- [ ] All errcheck issues fixed in test files (~41 issues)
- [ ] All gosec G104 issues fixed (~4 issues)
- [ ] All govet shadow issues fixed in test files (~5 issues)
- [ ] All unused type/field issues fixed (3 issues)
- [ ] All intrange issues fixed (2 issues)
- [ ] `make lint` exits with 0
- [ ] All tests pass
- [ ] Coverage remains at 90%+
</success_criteria>

<output>
After completion, create `.planning/phases/02.1-improve-code-quality-validating-linter-config/02.1-05-SUMMARY.md`
</output>
