---
phase: 37-core-discovery
plan: 02
type: execute
wave: 2
depends_on: [37-01]
files_modified: [examples/discovery/main.go, examples/discovery/discovery_test.go]
autonomous: true
must_haves:
  truths:
    - "Example demonstrates plugin discovery pattern"
    - "Test passes for discovery example"
  artifacts:
    - path: "examples/discovery/main.go"
      provides: "Working example of ResolveAll"
  key_links:
    - from: "examples/discovery/main.go"
      to: "gaz.ResolveAll"
      via: "API call"
---

<objective>
Verify the Discovery capabilities with a realistic integration example (Gateway/Plugin pattern).

Purpose: Demonstrates the "Dynamic Gateway" pattern required for Phase 39 and verifies the feature end-to-end.
Output: A working example in `examples/discovery`.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@di/resolution.go
@types.go
@examples/
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Discovery Example</name>
  <files>examples/discovery/main.go</files>
  <action>
    Create a new example `examples/discovery/main.go` that demonstrates the plugin pattern.
    
    Features:
    - Define a `Plugin` interface (e.g., `Name() string`, `Init()`).
    - Implement 2-3 plugins (`AuthPlugin`, `LoggerPlugin`).
    - Register them using `gaz.For[Plugin](c).Provider(...)`.
    - Use `gaz.ResolveAll[Plugin](c)` to find them.
    - Iterate and call methods on them.
    - Use `gaz.New()` app structure if appropriate, or just container.
  </action>
  <verify>go run examples/discovery/main.go</verify>
  <done>Example runs and prints discovered plugins</done>
</task>

<task type="auto">
  <name>Task 2: Add Integration Test</name>
  <files>examples/discovery/discovery_test.go</files>
  <action>
    Create a test file `examples/discovery/discovery_test.go` that validates the example logic.
    
    - Use `gaztest` helper if available, or standard `di` setup.
    - Register multiple implementations.
    - Verify `ResolveAll` returns the correct count.
    - Verify `ResolveGroup` filters correctly (e.g., group "system" vs "user").
  </action>
  <verify>go test -v ./examples/discovery/...</verify>
  <done>Integration test passes</done>
</task>

</tasks>

<verification>
Run the new example and test:
`go test -v ./examples/discovery/...`
</verification>

<success_criteria>
- Real-world "plugin" pattern is demonstrated and working.
- Users can see how to use ResolveAll for auto-discovery.
</success_criteria>

<output>
After completion, create `.planning/phases/37-core-discovery/37-02-SUMMARY.md`
</output>
