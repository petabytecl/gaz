---
phase: 29-documentation-examples
plan: 05
type: execute
wave: 2
depends_on: [29-01, 29-02, 29-03, 29-04]
files_modified:
  - docs/troubleshooting.md
  - README.md
  - docs/getting-started.md
  - docs/concepts.md
  - docs/advanced.md
autonomous: true

must_haves:
  truths:
    - "Troubleshooting page exists with common mistakes"
    - "README uses v3 patterns exclusively"
    - "README links to new example apps"
    - "Docs pages use v3 patterns exclusively"
  artifacts:
    - path: "docs/troubleshooting.md"
      provides: "Common mistakes and solutions"
      min_lines: 50
      contains: "Troubleshooting"
    - path: "README.md"
      provides: "Updated quick start with v3 patterns"
      contains: "gaz.For"
  key_links:
    - from: "README.md"
      to: "examples/"
      via: "Links to example apps"
      pattern: "\\[.*\\]\\(examples/"
    - from: "docs/getting-started.md"
      to: "v3 patterns"
      via: "Code examples"
      pattern: "gaz\\.For"
---

<objective>
Finalize documentation with troubleshooting page and v3 pattern verification.

Purpose: Complete DOC-02 requirements with troubleshooting docs. Verify all existing documentation uses v3 patterns exclusively (no deprecated v2 patterns).

Output: docs/troubleshooting.md (new), README.md updates, /docs page verification and updates.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/29-documentation-examples/29-RESEARCH.md
@.planning/phases/29-documentation-examples/29-CONTEXT.md

# Current documentation to verify/update
@README.md
@docs/getting-started.md
@docs/concepts.md
@docs/configuration.md
@docs/advanced.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create troubleshooting documentation</name>
  <files>docs/troubleshooting.md</files>
  <action>
Create `docs/troubleshooting.md` with common mistakes and solutions.

Per CONTEXT.md: "brief section covering common mistakes (not inline)"

Content structure:
```markdown
# Troubleshooting

Common issues and solutions when using gaz.

## Container Errors

### "type not registered" on Resolve

**Problem:** Calling `gaz.Resolve[T]()` before registering T.

**Solution:**
```go
// Wrong: resolve before register
svc, err := gaz.Resolve[*MyService](c) // error!

// Correct: register then resolve
gaz.For[*MyService](c).Provider(NewMyService)
c.Build()
svc, _ := gaz.Resolve[*MyService](c)
```

### "container not built" on Resolve

**Problem:** Resolving before calling `Build()`.

**Solution:**
```go
gaz.For[*MyService](c).Provider(...)
c.Build() // Don't forget!
svc, _ := gaz.Resolve[*MyService](c)
```

## Lifecycle Errors

### OnStart/OnStop not called

**Problem:** Service implements Starter/Stopper but methods not called.

**Causes:**
1. Service not registered as Eager
2. Service never resolved (lazy singletons aren't instantiated)
3. Using `Run()` without `Build()` first

**Solution:**
```go
// For services that must start immediately:
gaz.For[*Server](c).Eager().Provider(NewServer)
```

### Shutdown timeout

**Problem:** App takes too long to shut down.

**Solution:** Check OnStop implementations for blocking operations:
```go
func (s *Server) OnStop(ctx context.Context) error {
    // Use context deadline
    select {
    case <-s.done:
        return nil
    case <-ctx.Done():
        return ctx.Err() // Don't block forever
    }
}
```

## Configuration Errors

### Config key not found

**Problem:** `config.ErrKeyNotFound` when unmarshaling.

**Causes:**
1. YAML key doesn't match struct tag
2. Config file not loaded

**Solution:**
```go
// Check struct tags match config
type Config struct {
    Port int `gaz:"port"` // matches "port" in YAML
}

// Verify config file is loaded
fmt.Println(cfg.GetString("server.port")) // debug
```

### Validation fails on startup

**Problem:** App panics with validation error on Build().

**Solution:** Ensure config values meet validation rules:
```go
type Config struct {
    Port int `gaz:"port" validate:"required,min=1,max=65535"`
}
```

## Module Errors

### Import cycle with gaz package

**Problem:** `import cycle not allowed` when creating modules.

**Solution:** Use `di` package instead of `gaz` in subsystem modules:
```go
// In your module package
import "github.com/petabytecl/gaz/di"

func NewModule() di.Module {
    return di.NewModuleFunc(func(c *di.Container) error {
        // Register with di, not gaz
        return nil
    })
}
```

## Testing Errors

### Test App already built

**Problem:** `app already built` error in tests.

**Solution:** Create fresh app per test:
```go
func TestMyService(t *testing.T) {
    ta := gaztest.New(t) // Fresh app each test
    // ...
}
```

## See Also

- [Getting Started](getting-started.md) - First app walkthrough
- [Concepts](concepts.md) - DI fundamentals
- [Advanced](advanced.md) - Modules and testing
```

Focus on actionable solutions. Show wrong vs correct code patterns.
  </action>
  <verify>
```bash
test -f docs/troubleshooting.md && wc -l docs/troubleshooting.md
```
  </verify>
  <done>docs/troubleshooting.md exists with 50+ lines covering common container, lifecycle, config, module, and testing errors</done>
</task>

<task type="auto">
  <name>Task 2: Verify and update README and docs for v3 patterns</name>
  <files>README.md, docs/getting-started.md, docs/concepts.md, docs/advanced.md</files>
  <action>
Verify all documentation uses v3 patterns exclusively. Update any v2 patterns found.

**v3 patterns to verify:**
- `gaz.For[T](c).Provider(...)` (not fluent OnStart/OnStop)
- `OnStart(ctx context.Context) error` (not `OnStart() error`)
- `OnStop(ctx context.Context) error` (not `OnStop() error`)
- `worker.NewModule()` returns `di.Module`
- `di.NewModuleFunc()` for custom modules
- No `service.Builder` references (removed in v3)
- No fluent `.OnStart(func)` or `.OnStop(func)` on RegistrationBuilder

**Check each file:**

1. **README.md:**
   - Verify Quick Start uses `For[T]().Provider()`
   - Verify lifecycle example uses interface-based hooks
   - Add links to new examples (background-workers, microservice)
   - Ensure examples list includes all 7+ example apps

2. **docs/getting-started.md:**
   - Verify all code examples use v3 patterns
   - Update any outdated patterns

3. **docs/concepts.md:**
   - Verify lifecycle section shows interface-based hooks
   - Verify scope examples use v3 patterns

4. **docs/advanced.md:**
   - Verify module examples use `di.Module` / `di.NewModuleFunc()`
   - Verify testing examples use gaztest v3 patterns

**Update README examples section:**
```markdown
## Examples

See the [examples](examples/) directory:

- [basic](examples/basic/) - Minimal working application
- [http-server](examples/http-server/) - HTTP server with graceful shutdown
- [config-loading](examples/config-loading/) - Configuration files and environment variables
- [lifecycle](examples/lifecycle/) - Services with OnStart/OnStop hooks
- [modules](examples/modules/) - Organizing providers into modules
- [cobra-cli](examples/cobra-cli/) - CLI application with Cobra
- [background-workers](examples/background-workers/) - Background task processing
- [microservice](examples/microservice/) - Complete microservice with config, health, workers
```

**Add troubleshooting link to Documentation section:**
```markdown
## Documentation

- [Getting Started](docs/getting-started.md) - First application walkthrough
- [Concepts](docs/concepts.md) - DI fundamentals, scopes, lifecycle
- [Configuration](docs/configuration.md) - Config loading, env vars, validation
- [Validation](docs/validation.md) - Struct tags and custom validators
- [Advanced](docs/advanced.md) - Modules, testing, Cobra integration
- [Troubleshooting](docs/troubleshooting.md) - Common issues and solutions
```
  </action>
  <verify>
```bash
# Check for v2 patterns (should return 0 or only in appropriate contexts)
grep -r "OnStart()" docs/ README.md | grep -v "OnStart(ctx" | head -5
grep -r "OnStop()" docs/ README.md | grep -v "OnStop(ctx" | head -5
grep -r "service\.Builder" docs/ README.md | head -5

# Verify new examples are linked
grep -c "background-workers" README.md
grep -c "microservice" README.md
grep -c "troubleshooting" README.md
```
  </verify>
  <done>README.md and docs/*.md use v3 patterns exclusively; README links to all examples including new ones; troubleshooting linked in Documentation section</done>
</task>

</tasks>

<verification>
```bash
# Full verification
echo "=== Checking for v2 patterns ==="
grep -rn "\.OnStart(func" docs/ README.md || echo "No fluent OnStart found"
grep -rn "\.OnStop(func" docs/ README.md || echo "No fluent OnStop found"
grep -rn "service\.Builder" docs/ README.md || echo "No service.Builder found"

echo "=== Verifying new content ==="
test -f docs/troubleshooting.md && echo "troubleshooting.md exists"
grep "background-workers" README.md && echo "background-workers linked"
grep "microservice" README.md && echo "microservice linked"
grep "Troubleshooting" README.md && echo "Troubleshooting linked"

echo "=== Building docs check ==="
wc -l docs/*.md README.md
```
</verification>

<success_criteria>
1. docs/troubleshooting.md exists with 50+ lines of actionable troubleshooting content
2. README.md links to all 8 example apps (7 existing + 2 new - 1 overlap = 8)
3. README.md Documentation section links to troubleshooting
4. All code examples in README.md and docs/*.md use v3 patterns
5. No fluent OnStart/OnStop patterns remain
6. No service.Builder references remain
7. All lifecycle examples use context-aware interface methods
</success_criteria>

<output>
After completion, create `.planning/phases/29-documentation-examples/29-05-SUMMARY.md`
</output>
