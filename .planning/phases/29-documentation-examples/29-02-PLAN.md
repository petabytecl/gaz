---
phase: 29-documentation-examples
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - health/doc.go
  - health/example_test.go
  - eventbus/example_test.go
autonomous: true

must_haves:
  truths:
    - "Health package has package-level documentation"
    - "Health package has testable examples for all major APIs"
    - "EventBus package has testable examples for all major APIs"
    - "Examples run and pass with go test"
  artifacts:
    - path: "health/doc.go"
      provides: "Package-level documentation for health"
      min_lines: 20
      contains: "Package health"
    - path: "health/example_test.go"
      provides: "Godoc examples for health package"
      min_lines: 80
      contains: "func Example"
    - path: "eventbus/example_test.go"
      provides: "Godoc examples for eventbus package"
      min_lines: 80
      contains: "func Example"
  key_links:
    - from: "health/example_test.go"
      to: "health package exports"
      via: "Example functions reference public API"
      pattern: "health\\.(Manager|NewModule|Check)"
    - from: "eventbus/example_test.go"
      to: "eventbus package exports"
      via: "Example functions reference public API"
      pattern: "eventbus\\.(Bus|Subscribe|Publish)"
---

<objective>
Create package documentation and godoc examples for health and eventbus packages.

Purpose: Health package is the only core package missing doc.go. Both packages need example_test.go files for DOC-03 compliance.

Output: health/doc.go (new), health/example_test.go (new), eventbus/example_test.go (new)
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/29-documentation-examples/29-RESEARCH.md

# Existing doc.go patterns
@di/doc.go
@worker/doc.go
@eventbus/doc.go

# Health package exports to cover
@health/manager.go
@health/module.go
@health/types.go
@health/server.go

# EventBus package exports to cover
@eventbus/bus.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create health package documentation and examples</name>
  <files>health/doc.go, health/example_test.go</files>
  <action>
**Part A: Create health/doc.go**

Create package-level documentation following the pattern from di/doc.go and worker/doc.go:

```go
// Package health provides health check management for gaz applications.
//
// Health checks are used to determine if a service is ready to receive
// traffic (readiness) and if it's still alive (liveness). The package
// integrates with gaz's DI container and lifecycle management.
//
// # Quick Start
//
// Use NewModule() to register health infrastructure with your app:
//
//     app := gaz.New()
//     app.UseDI(health.NewModule())
//     app.Build()
//
// # Health Checks
//
// Implement the Check interface to create custom health checks:
//
//     type DatabaseCheck struct {
//         db *sql.DB
//     }
//
//     func (c *DatabaseCheck) Name() string { return "database" }
//     func (c *DatabaseCheck) Check(ctx context.Context) error {
//         return c.db.PingContext(ctx)
//     }
//
// # HTTP Server
//
// The package includes an HTTP server exposing /healthz (liveness)
// and /readyz (readiness) endpoints.
package health
```

**Part B: Create health/example_test.go**

Required examples:
1. `ExampleNewModule` - Creating and using health module
2. `ExampleManager` - Using health manager directly
3. `ExampleManager_RegisterCheck` - Registering custom checks
4. `ExampleManager_RunChecks` - Running health checks
5. `Example_customCheck` - Implementing Check interface
6. `ExampleTestConfig` - Using test configuration
7. `ExampleMockRegistrar` - Using mock for testing

Pattern:
```go
package health_test

import (
    "context"
    "fmt"
    "github.com/petabytecl/gaz/health"
)

func ExampleManager_RegisterCheck() {
    mgr := health.NewManager(nil)
    // ... register and run
    // Output: ...
}
```

Note: Many health APIs are async/HTTP-based. Use `// Output:` where feasible, skip for lifecycle-heavy examples.
  </action>
  <verify>
```bash
go test -v -run Example ./health/...
go doc ./health/ | head -20
```
  </verify>
  <done>health/doc.go exists with package documentation; health/example_test.go exists with 5+ Example functions</done>
</task>

<task type="auto">
  <name>Task 2: Create eventbus package examples</name>
  <files>eventbus/example_test.go</files>
  <action>
Create `eventbus/example_test.go` with testable godoc examples for eventbus package.

Required examples:
1. `ExampleNewBus` - Creating a new event bus
2. `ExampleBus_Subscribe` - Subscribing to events
3. `ExampleBus_Publish` - Publishing events
4. `ExampleBus_Unsubscribe` - Unsubscribing from events
5. `Example_typedEvents` - Using typed event structs
6. `ExampleNewModule` - Creating eventbus module
7. `ExampleTestBus` - Using test bus factory
8. `ExampleTestSubscriber` - Using test subscriber helper

Pattern:
```go
package eventbus_test

import (
    "context"
    "fmt"
    "github.com/petabytecl/gaz/eventbus"
)

type UserCreatedEvent struct {
    UserID string
    Email  string
}

func ExampleBus_Publish() {
    bus := eventbus.NewBus()
    
    // Subscribe
    sub := bus.Subscribe(func(ctx context.Context, evt UserCreatedEvent) error {
        fmt.Println("user:", evt.UserID)
        return nil
    })
    defer sub.Unsubscribe()
    
    // Publish
    bus.Publish(context.Background(), UserCreatedEvent{UserID: "123", Email: "test@example.com"})
    // Output: user: 123
}
```

Note: Eventbus is synchronous by default, so `// Output:` comments work for most examples.
  </action>
  <verify>
```bash
go test -v -run Example ./eventbus/...
```
  </verify>
  <done>eventbus/example_test.go exists with 8+ testable Example functions covering Bus, Subscribe, Publish, Module APIs</done>
</task>

</tasks>

<verification>
```bash
# Run all examples
go test -v -run Example ./health/... ./eventbus/...

# Verify package doc exists
go doc ./health/ | head -5

# Count examples
go doc -all ./health/ | grep -c "func Example"
go doc -all ./eventbus/ | grep -c "func Example"
```
</verification>

<success_criteria>
1. health/doc.go exists with comprehensive package documentation
2. health/example_test.go exists with 5+ Example functions
3. eventbus/example_test.go exists with 8+ Example functions
4. All examples have `// Output:` where deterministic
5. Examples cover major APIs: Manager, Check, NewModule (health); Bus, Subscribe, Publish (eventbus)
</success_criteria>

<output>
After completion, create `.planning/phases/29-documentation-examples/29-02-SUMMARY.md`
</output>
