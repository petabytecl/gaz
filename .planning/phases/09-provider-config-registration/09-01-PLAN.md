---
phase: 09-provider-config-registration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - provider_config.go
  - errors.go
autonomous: true

must_haves:
  truths:
    - "ConfigProvider interface exists for providers to implement"
    - "ConfigFlag struct defines key, type, default, required, description"
    - "ErrConfigKeyCollision error exists for collision detection"
  artifacts:
    - path: "provider_config.go"
      provides: "ConfigProvider interface and ConfigFlag struct"
      exports: ["ConfigProvider", "ConfigFlag", "ConfigFlagType"]
    - path: "errors.go"
      provides: "ErrConfigKeyCollision sentinel error"
      contains: "ErrConfigKeyCollision"
  key_links:
    - from: "provider_config.go"
      to: "gaz package"
      via: "package declaration"
      pattern: "package gaz"
---

<objective>
Define the core types for provider config registration: the ConfigProvider interface that providers implement, the ConfigFlag struct that describes each config key, and the error for key collision detection.

Purpose: Establish the foundation types that enable providers to declare their configuration needs. This is the API surface that module developers will use.

Output: provider_config.go with interface and types, updated errors.go with collision error.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/09-provider-config-registration/09-CONTEXT.md

@config.go
@lifecycle.go
@errors.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ConfigFlag type and ConfigProvider interface</name>
  <files>provider_config.go</files>
  <action>
Create new file `provider_config.go` with:

1. **ConfigFlagType** enum (string-based) for supported value types:
   - `ConfigFlagTypeString` = "string"
   - `ConfigFlagTypeInt` = "int"
   - `ConfigFlagTypeBool` = "bool"
   - `ConfigFlagTypeDuration` = "duration"
   - `ConfigFlagTypeFloat` = "float"

2. **ConfigFlag** struct with fields:
   - `Key string` - the config key relative to namespace (e.g., "host", "port")
   - `Type ConfigFlagType` - value type for parsing
   - `Default any` - default value (nil means no default)
   - `Required bool` - if true, validation fails when missing
   - `Description string` - help text for --help and docs

3. **ConfigProvider** interface:
   - `ConfigNamespace() string` - returns the namespace prefix (e.g., "redis")
   - `ConfigFlags() []ConfigFlag` - returns the config flags this provider needs

Add godoc comments explaining:
- Providers implement ConfigProvider to declare config needs
- Namespace is auto-prefixed to keys (e.g., "redis" + "host" = "redis.host")
- Required flags must be set via env, file, or flag (error at Build() if missing)
- Type field determines parsing (string is raw, int/bool/duration parsed)

Follow existing interface patterns from lifecycle.go (Starter, Stopper).
  </action>
  <verify>`go build ./...` passes with new types</verify>
  <done>ConfigProvider interface and ConfigFlag struct exist with all required fields</done>
</task>

<task type="auto">
  <name>Task 2: Add ErrConfigKeyCollision error</name>
  <files>errors.go</files>
  <action>
Add new sentinel error to errors.go:

```go
// ErrConfigKeyCollision is returned when two providers register the same config key.
ErrConfigKeyCollision = errors.New("gaz: config key collision")
```

Place it after ErrDuplicateModule (alphabetical/logical ordering).

This error will be used when collision detection finds duplicate keys during Build().
  </action>
  <verify>`go build ./...` passes, error is exported</verify>
  <done>ErrConfigKeyCollision exists in errors.go</done>
</task>

</tasks>

<verification>
```bash
# All code compiles
go build ./...

# New types are accessible
go doc github.com/petabytecl/gaz ConfigProvider
go doc github.com/petabytecl/gaz ConfigFlag
go doc github.com/petabytecl/gaz ErrConfigKeyCollision
```
</verification>

<success_criteria>
1. provider_config.go exists with ConfigProvider interface and ConfigFlag struct
2. ConfigFlagType enum exists with string, int, bool, duration, float types
3. ConfigFlag has Key, Type, Default, Required, Description fields
4. ConfigProvider has ConfigNamespace() and ConfigFlags() methods
5. ErrConfigKeyCollision exists in errors.go
6. `go build ./...` passes
</success_criteria>

<output>
After completion, create `.planning/phases/09-provider-config-registration/09-01-SUMMARY.md`
</output>
